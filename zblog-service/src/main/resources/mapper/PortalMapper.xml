<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.github.stazxr.zblog.mapper.PortalMapper">
    <select id="selectBlogWebInfo" resultType="com.github.stazxr.zblog.domain.vo.BlogWebVo">
        SELECT
            (
                <!-- 查询已发布的公开的文章数量 -->
                SELECT COUNT(1) FROM article WHERE DELETED = 0 AND ARTICLE_STATUS = 5 AND ARTICLE_PERM = 1
            ) ARTICLE_COUNT,
            (
                <!-- 查询启用的二级类别数量 -->
                SELECT COUNT(1) FROM article_category WHERE DELETED = 0 AND ENABLED = 1 AND PID IS NULL
            ) CATEGORY_COUNT,
            (
                SELECT COUNT(1) FROM article_tag WHERE DELETED = 0 AND ENABLED = 1 AND ID IN (
                    SELECT TAG_ID FROM article_tag_relation WHERE ARTICLE_ID IN (
                        SELECT ID FROM article WHERE DELETED = 0 AND ARTICLE_STATUS = 5 AND ARTICLE_PERM = 1
                    )
                )
            ) TAG_COUNT,
            (
                SELECT WEB_COUNT FROM visitor_count WHERE ID = 1
            ) VIEWS_COUNT
        FROM DUAL
    </select>
</mapper>
